{"version":3,"sources":["../src/service/routes/belo-boom.ts"],"names":["boom","fp","helperMethods","Set","addBoomToReply","reply","key","Object","getOwnPropertyNames","has","inputs","boomed","boomedPayloadAndAdditionalResponse","assign","output","payload","status","statusCode","type","headers","send","beloBoomPlugin","fastify","_options","addHook","_request","hasReplyDecorator","fastifyBeloBoom","name"],"mappings":";;;;;AAAA,OAAOA,UAAU;AAOjB,OAAOC,QAAQ;AAEf,IAAMC,gBAAgB,oBAAIC,IAAI;EAAC;EAAQ;CAAS;AAEhD,SAASC,eAAeC,OAAqB;AAC3C,aAAWC,OAAOC,OAAOC,oBAAoBR,IAAAA,GAAO;AAClD,QAAI,OAAOA,KAAKM,SAAS,YAAY;AACnC;IACF;AAEA,QAAIJ,cAAcO,IAAIH,GAAAA,GAAM;AAC1BD,YAAML,KAAKM,OAAO,YAAaI,QAAQ;AACrC,eAAOV,KAAKM,KAAI,GAAII,MAAAA;MACtB;IACF,OAAO;AACLL,YAAML,KAAKM,OAAO,YAAaI,QAAQ;AACrC,cAAMC,SAASX,KAAKM,KAAI,GAAII,MAAAA;AAE5B,cAAME,qCAAqCL,OAAOM,OAChDF,OAAOG,OAAOC,SACdL,OAAO,EAAE;AAEX,eAAOL,MACJW,OAAOL,OAAOG,OAAOG,UAAU,EAC/BC,KAAK,kBAAA,EACLC,QAAQR,OAAOG,OAAOK,OAAO,EAC7BC,KAAKR,kCAAAA;MACV;IACF;EACF;AACF;AA1BSR;AA4BT,IAAMiB,iBAAqC,8BACzCC,SACAC,aACG;AACHD,UAAQE,QAAQ,aAAa,OAAOC,UAAUpB,UAAU;AACtD,QAAI,CAACiB,QAAQI,kBAAkB,MAAA,GAAS;AACtCrB,YAAML,OAAO,CAAC;AACdI,qBAAeC,KAAAA;IACjB;EACF,CAAA;AACF,GAV2C;AAYpC,IAAMsB,kBAAkB1B,GAAGoB,gBAAgB;EAChDC,SAAS;EACTM,MAAM;AACR,CAAA;AAEA,IAAA,oBAAeD","sourcesContent":["import boom from \"@hapi/boom\";\nimport {\n  FastifyInstance,\n  FastifyPluginAsync,\n  FastifyPluginOptions,\n  FastifyReply,\n} from \"fastify\";\nimport fp from \"fastify-plugin\";\n\nconst helperMethods = new Set([\"wrap\", \"create\"]);\n\nfunction addBoomToReply(reply: FastifyReply) {\n  for (const key of Object.getOwnPropertyNames(boom)) {\n    if (typeof boom[key] !== \"function\") {\n      continue;\n    }\n\n    if (helperMethods.has(key)) {\n      reply.boom[key] = function (...inputs) {\n        return boom[key](...inputs);\n      };\n    } else {\n      reply.boom[key] = function (...inputs) {\n        const boomed = boom[key](...inputs);\n\n        const boomedPayloadAndAdditionalResponse = Object.assign(\n          boomed.output.payload,\n          inputs[1]\n        );\n        return reply\n          .status(boomed.output.statusCode)\n          .type(\"application/json\")\n          .headers(boomed.output.headers)\n          .send(boomedPayloadAndAdditionalResponse);\n      };\n    }\n  }\n}\n\nconst beloBoomPlugin: FastifyPluginAsync = async (\n  fastify: FastifyInstance,\n  _options: FastifyPluginOptions\n) => {\n  fastify.addHook(\"onRequest\", async (_request, reply) => {\n    if (!fastify.hasReplyDecorator(\"boom\")) {\n      reply.boom = {} as any;\n      addBoomToReply(reply);\n    }\n  });\n};\n\nexport const fastifyBeloBoom = fp(beloBoomPlugin, {\n  fastify: \"4.x\",\n  name: \"@fastify/belo-boom\",\n});\n\nexport default fastifyBeloBoom;\n"]}